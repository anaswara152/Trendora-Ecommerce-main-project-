{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Summary</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<style>
    body {
        background-color: #f8f9fa;
    }
    .card {
        border-radius: 10px;
        box-shadow: 0 0.25rem 0.75rem rgba(0,0,0,.05);
    }
    .card-header {
        font-weight: 600;
    }
    .product-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 5px;
    }
</style>
</head>
<body>
<div class="container mt-5">

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary fw-bold"><i class="fa-solid fa-receipt"></i> Order Summary</h2>
        <a href="{% url 'viewcart' %}" class="btn btn-outline-info">
            <i class="fa-solid fa-arrow-left"></i> Back to Cart
        </a>
    </div>

    <div class="row">
        <!-- Pickup Details -->
        {% for i in v %}
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    Pickup Details
                </div>
                <div class="card-body">
                    <form id="pickupForm">
                        <div class="mb-2">
                            <label class="form-label fw-semibold">Name</label>
                            <input type="text" class="form-control" value="{{ i.user.first_name }} {{ i.user.last_name }}" name="name" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label fw-semibold">Phone</label>
                            <input type="text" class="form-control" id="phone" name="phone" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label fw-semibold">Email</label>
                            <input type="email" class="form-control" value="{{ i.user.email }}" name="email" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label fw-semibold">Address</label>
                            <input type="text" class="form-control" value="{{ i.address }}" name="address" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label fw-semibold">City</label>
                                <input type="text" class="form-control" value="{{ i.city }}" name="city" required>
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label fw-semibold">State</label>
                                <input type="text" class="form-control" value="{{ i.state }}" name="state" required>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label fw-semibold">Postal Code</label>
                            <input type="text" class="form-control" value="{{ i.postalcode }}" name="postalcode" required>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    Your Order
                </div>
                <div class="card-body">
                    {% for m in n %}
                    <div class="d-flex align-items-center mb-3 border-bottom pb-2">
                        <div class="me-3">
                            {% if m.productid.image %}
                                <img src="{{ m.productid.image.url }}" class="product-img" alt="{{ m.productid.name }}">
                            {% else %}
                                <img src="{% static 'no-image.png' %}" class="product-img" alt="No Image">
                            {% endif %}
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="fw-semibold mb-1">{{ m.productid.name }}</h6>
                            <small class="text-muted">{{ m.productid.description|truncatewords:10 }}</small><br>
                            <span class="badge bg-info">{{ m.productid.categoryid.cname }}</span>
                        </div>
                        <div class="text-end">
                            <p class="mb-1 fw-semibold">Qty: {{ m.count }}</p>
                            <p class="mb-0 fw-bold text-success">${{ m.price }}</p>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="d-flex justify-content-between mt-3 pt-3 border-top">
                        <h5>Total</h5>
                        <h5 class="text-success fw-bold">${{ gr }}</h5>
                    </div>
                </div>

                <!-- Place Order Button -->
                <div class="card-footer text-end bg-light">
                    <form action="{% url 'checkout' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="grandtotal" value="{{ gr }}">
                        <input type="hidden" name="name" value="{{ i.user.first_name }} {{ i.user.last_name }}">
                        <input type="hidden" name="phone" value="{{ i.phone }}">
                        <input type="hidden" name="email" value="{{ i.user.email }}">
                        <input type="hidden" name="address" value="{{ i.address }}">
                        <input type="hidden" name="city" value="{{ i.city }}">
                        <input type="hidden" name="state" value="{{ i.state }}">
                        <input type="hidden" name="postalcode" value="{{ i.postalcode }}">
                        <button type="submit" class="btn btn-success btn-lg fw-bold">
                            <i class="fa-solid fa-credit-card"></i> Place Order
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% if messages %}
{% for msg in messages %}
<script>alert("{{ msg }}")</script>
{% endfor %}
{% endif %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
